<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="assets/style.css?t=615badd5">
    <script src="assets/script.js?t=42463e55"></script>
    <title>Barista</title>
    <meta name="viewport" content="width=device-width">
  </head>
  <body class="-menu-visible">
    <div class="doc-layout">
      <div class="toggle menu-toggle js-menu-toggle"></div>
      <div class="menu toc-menu">
        <li class="menu-item -level-0 -parent">
          <ul class="submenu">
            <li class="menu-item -level-1"><a class="link title -active link-index" href="index.html">Barista</a>
            </li>
            <li class="menu-item -level-1"><a class="link title link-barista's-interactions-api" href="#barista's-interactions-api">Barista’s Interactions API</a>
            </li>
            <li class="menu-item -level-1 -parent"><a class="link title link-barista's-assertions-api" href="#barista's-assertions-api">Barista’s Assertions API</a>
              <ul class="submenu">
                <li class="menu-item -level-2"><a class="link title link-custom-assertions" href="#custom-assertions">Custom assertions</a>
                </li>
              </ul>
            </li>
            <li class="menu-item -level-1"><a class="link title link-barista's-intents-api" href="#barista's-intents-api">Barista’s Intents API</a>
            </li>
            <li class="menu-item -level-1"><a class="link title link-runtime-permissions" href="#runtime-permissions">Runtime Permissions</a>
            </li>
            <li class="menu-item -level-1 -parent"><a class="link title link-useful-test-rules" href="#useful-test-rules">Useful test rules</a>
              <ul class="submenu">
                <li class="menu-item -level-2"><a class="link title link-reseting-app-data" href="#reseting-app-data">Reseting app data</a>
                </li>
                <li class="menu-item -level-2"><a class="link title link-dealing-with-flaky-tests" href="#dealing-with-flaky-tests">Dealing with Flaky tests</a>
                </li>
                <li class="menu-item -level-2"><a class="link title link-one-rule-to-rule-them-all" href="#one-rule-to-rule-them-all">One rule to rule them all</a>
                </li>
                <li class="menu-item -level-2"><a class="link title link-writing-tests-in-kotlin" href="#writing-tests-in-kotlin">Writing tests in Kotlin?</a>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </div>
      <div class="body page-index">
        <div class="header-nav">
          <div class="right">
          </div>
        </div>
        <div class="markdown-body"><h1 id="barista">Barista</h1>
<p><strong>The guy who serves a great Espresso</strong></p>
<p><a href="https://travis-ci.org/SchibstedSpain/Barista"><img src="https://img.shields.io/travis/rust-lang/rust.svg?label=Travis+CI" alt="Travis"></a>
<a href="https://bintray.com/schibstedspain/maven/barista/_latestVersion"><img src="https://api.bintray.com/packages/schibstedspain/maven/barista/images/download.svg" alt="Download"></a></p>
<p>Barista makes developing UI test faster, easier and more predictable. Built on top of Espresso, it provides a simple an discoverable API, removing most of the boilerplate and verbosity of common Espresso tasks. You and your Android team will write tests with no effort.</p>
<ul>
<li><a href="#download">Download</a></li>
<li><a href="#api-overview">API Overview</a>
<ul>
<li><a href="#baristas-interactions-api">Interactions</a></li>
<li><a href="#baristas-assertions-api">Assertions</a></li>
<li><a href="#baristas-intents-api">Intents</a></li>
<li><a href="#runtime-permissions">Runtime Permissions</a></li>
<li><a href="#useful-test-rules">Useful test rules</a>
<ul>
<li><a href="#reseting-app-data">Reseting app data</a></li>
<li><a href="#dealing-with-flaky-tests">Dealing with Flaky tests</a></li>
<li><a href="#one-rule-to-rule-them-all">One rule to rule them all</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#magic-that-barista-does-for-you">Magic that Barista does for you</a></li>
<li><a href="#license">License</a></li>
</ul>
<h1 id="download">Download</h1>
<p>Import Barista as a testing dependency:</p>
<pre><code class="lang-gradle">androidTestImplementation(<span class="pl-s">&apos;com.schibsted.spain:barista:2.7.0&apos;</span>) {
  <span class="pl-k">exclude</span> <span class="pl-k">group</span>: <span class="pl-s">&apos;com.android.support&apos;</span>
  <span class="pl-k">exclude</span> <span class="pl-k">group</span>: <span class="pl-s">&apos;org.jetbrains.kotlin&apos;</span> <span class="pl-c">// Only if you already use Kotlin in your project</span>
}
</code></pre>
<p>You might need to include the Google Maven repository, required by Espresso 3:</p>
<pre><code class="lang-gradle"><span class="pl-k">repositories</span> {
    google()
}
</code></pre>
<p>Barista already includes <code>espresso-core</code> and <code>espresso-contrib</code>. If you need <a href="https://developer.android.com/topic/libraries/testing-support-library/packages.html#atsl-dependencies">any other Espresso package</a> you can add them yourself.</p>
<h1 id="api-overview">API Overview</h1>
<h2 id="barista&apos;s-interactions-api">Barista&#x2019;s Interactions API</h2>
<pre><code class="lang-java"><span class="pl-c">// Click widgets</span>
clickOn(R.id.button);
clickOn(R.string.button_text);
clickOn(<span class="pl-s">&quot;Next&quot;</span>);
clickBack();

<span class="pl-c">// Long click widgets</span>
longClickOn(R.id.button);
longClickOn(R.string.button_text);
longClickOn(<span class="pl-s">&quot;Next&quot;</span>);

<span class="pl-c">// Click menu items, with or without overflow</span>
clickMenu(R.id.menu_item);

<span class="pl-c">// Writing into widgets</span>
writeTo(R.id.edittext, <span class="pl-s">&quot;A great text&quot;</span>);
writeToAutoComplete(R.id.autocomplete, <span class="pl-s">&quot;Another great text&quot;</span>);
clearText(R.id.edittext)

<span class="pl-c">// Operate on ListViews and RecyclerViews indistinctly by position</span>
clickListItem(R.id.list, <span class="hljs-number">4</span>);
clickListItemChild(R.id.list, <span class="hljs-number">3</span>, R.id.row_button);
scrollListToPosition(R.id.list, <span class="hljs-number">4</span>);
assertListItemCount(R.id.listId, <span class="hljs-number">5</span>)
assertDisplayedAtPosition(R.id.recycler, <span class="hljs-number">0</span>, <span class="pl-s">&quot;text&quot;</span>);
assertDisplayedAtPosition(R.id.listId, <span class="hljs-number">0</span>, R.id.text_field, <span class="pl-s">&quot;text&quot;</span>);

clickSpinnerItem(R.id.spinner, <span class="hljs-number">1</span>);

<span class="pl-c">// Select items on RadioButtons</span>
clickRadioButtonItem(R.id.radiogroup, R.id.radio_item);
clickRadioButtonItem(R.id.radiogroup, <span class="pl-s">&quot;The radio text&quot;</span>);
clickRadioButtonPosition(R.id.radiogroup, <span class="hljs-number">42</span>);

<span class="pl-c">// Pick data on pickers</span>
setDateOnPicker(<span class="hljs-number">1986</span>, <span class="hljs-number">03</span>, <span class="hljs-number">23</span>);
setTimeOnPicker(<span class="hljs-number">17</span>, <span class="hljs-number">2</span>);

<span class="pl-c">// Interact with dialogs</span>
clickDialogPositiveButton();
clickDialogNeutralButton();
clickDialogNegativeButton();

<span class="pl-c">// Scroll on scrolls and pagers</span>
scrollTo(R.id.far_away_widget);
scrollTo(R.string.text);
scrollTo(<span class="pl-s">&quot;A widget with this text&quot;</span>);
swipeViewPagerForward();
swipeViewPagerBack();

<span class="pl-c">// Interact with the navigation drawer</span>
openDrawer();
openDrawerWithGravity(Gravity.RIGHT);
closeDrawer();
closeDrawerWithGravity(Gravity.RIGHT);

<span class="pl-c">// Interact with SeekBars</span>
setProgressTo(R.id.seek_bar, <span class="hljs-number">5</span>);
setProgressToMin(R.id.seek_bar);
setProgressToMax(R.id.seek_bar);


<span class="pl-c">// Pull to refresh in SwipeRefreshLayout</span>
refresh(R.id.swipe_refresh);
refresh(); <span class="pl-c">// Id is optional! We&apos;ll find it for you :D</span>

<span class="pl-c">// Close or press ime actions on the Keyboard</span>
closeKeyboard()
pressImeActionButton()

<span class="pl-c">// And another tricky feature, but try not to use it</span>
sleep(<span class="hljs-number">2000</span>);
sleep(<span class="hljs-number">2</span>, SECONDS);
</code></pre>
<h2 id="barista&apos;s-assertions-api">Barista&#x2019;s Assertions API</h2>
<pre><code class="lang-java"><span class="pl-c">// Is this view displayed?</span>
assertDisplayed(<span class="pl-s">&quot;Hello world&quot;</span>);
assertDisplayed(R.string.hello_world);
assertDisplayed(R.id.button);
assertDisplayed(R.id.button, <span class="pl-s">&quot;Hello world&quot;</span>)

<span class="pl-c">// ...or not?</span>
assertNotDisplayed(<span class="pl-s">&quot;Hello world&quot;</span>);
assertNotDisplayed(R.string.hello_world);
assertNotDisplayed(R.id.button);
assertNotDisplayed(R.id.button, <span class="pl-s">&quot;Hello world&quot;</span>)

<span class="pl-c">// Is this view enabled?</span>
assertEnabled(<span class="pl-s">&quot;Hello world&quot;</span>);
assertEnabled(R.string.hello_world);
assertEnabled(R.id.button);

<span class="pl-c">// ...or not?</span>
assertDisabled(<span class="pl-s">&quot;Hello world&quot;</span>);
assertDisabled(R.string.hello_world);
assertDisabled(R.id.button);

<span class="pl-c">// Hope this view doesn&apos;t exist!</span>
assertNotExist(<span class="pl-s">&quot;Hello world&quot;</span>);
assertNotExist(R.string.hello_world);
assertNotExist(R.id.button);

<span class="pl-c">// Is the expected checkbox checked?</span>
assertChecked(<span class="pl-s">&quot;Checked checkbox&quot;</span>);
assertChecked(R.string.checked_checkbox);
assertChecked(R.id.checked_checkbox);

<span class="pl-c">// ...and the other checkbox unchecked?</span>
assertUnchecked(<span class="pl-s">&quot;Unchecked checkbox&quot;</span>);
assertUnchecked(R.string.unchecked_checkbox);
assertUnchecked(R.id.unchecked_checkbox);

<span class="pl-c">// Does this view have the focus?</span>
assertFocused(R.id.focused_view)
assertFocused(<span class="pl-s">&quot;Button&quot;</span>)

<span class="pl-c">// ... or not?</span>
assertNotFocused(R.id.focused_view)
assertNotFocused(<span class="pl-s">&quot;Button&quot;</span>)

<span class="pl-c">// Is this ImageView showing a drawable?</span>
assertHasAnyDrawable(R.id.image_view);
assertHasDrawable(R.id.image_view, R.drawable.ic_barista);

<span class="pl-c">// ...or not?</span>
assertHasNoDrawable(R.id.image_view);

<span class="pl-c">// Does this View have a background?</span>
assertHasAnyBackground(R.id.view);
assertHasBackground(R.id.view, R.drawable.ic_barista);

<span class="pl-c">// ...or not?</span>
assertHasNoBackground(R.id.view);

<span class="pl-c">// What&apos;s the state of the Drawer?</span>
assertDrawerIsOpen();
assertDrawerIsOpenWithGravity(Gravity.RIGHT);
assertDrawerIsClosed();
assertDrawerIsClosedWithGravity(Gravity.RIGHT);

<span class="pl-c">// Check TextInputLayout and EditText&apos;s hints</span>
assertHint(R.id.edittext, R.string.hint);
assertHint(R.id.edittext, <span class="pl-s">&quot;Hint&quot;</span>);

<span class="pl-c">// Check TextInputLayout and EditText&apos;s errors</span>
assertError(R.id.edittext, R.string.error);
assertError(R.id.edittext, <span class="pl-s">&quot;Error message&quot;</span>);

<span class="pl-c">// Check if text on screen contains given text</span>
assertContains(<span class="pl-s">&quot;text&quot;</span>);
assertContains(R.id.textview, <span class="pl-s">&quot;text&quot;</span>);

<span class="pl-c">// ...or not?</span>
assertNotContains(<span class="pl-s">&quot;text&quot;</span>);
assertNotContains(R.id.textview, <span class="pl-s">&quot;text&quot;</span>);

<span class="pl-c">// Check text is given color</span>
assertTextColorIs(R.id.someRedText, R.color.red);
assertTextColorIs(R.id.someColorListText, R.color.state_list);

<span class="pl-c">// ...or not?</span>
assertTextColorIsNot(R.id.someRedText, R.color.blue);
assertTextColorIsNot(R.id.someColorListText, R.color.another_state_list);

<span class="pl-c">// Check recyclerView item count against expected item count</span>
assertRecyclerViewItemCount(R.id.recycler, <span class="hljs-number">10</span>);

<span class="pl-c">// And another tricky feature</span>
assertThatBackButtonClosesTheApp();

<span class="pl-c">// Is this ImageView showing a drawable?</span>
assertHasAnyDrawable(R.id.image_view);
assertHasDrawable(R.id.image_view, R.drawable.ic_barista);

<span class="pl-c">// ...or not?</span>
assertHasNoDrawable(R.id.image_view);


<span class="pl-c">// Is this ProgressBar/SeekBar progress?</span>
assertProgress(R.id.seek_bar, <span class="hljs-number">5</span>)
assertProgressIsMin(R.id.seek_bar)
assertProgressIsMax(R.id.seek_bar)


</code></pre>
<h3 id="custom-assertions">Custom assertions</h3>
<p>If you have a special case not covered by the given assertions API, we encourage you to assert these special cases with our custom assertions API. It&apos;s a convenient way to replace plain <code>Matcher</code>s with complex assertions. With Barista, you can match any kind of view by knowing its type and passing its <code>viewId</code>, <code>text</code>, or a <code>Matcher&lt;View&gt;</code>. Once you matched it, you will be able to assert all its properties without adding any complex <code>Matcher</code> to your project.</p>
<pre><code class="lang-kotlin">
<span class="pl-c">// Matching a Button by text</span>
assertAny&lt;Button&gt;(<span class="pl-s">&quot;Save&quot;</span>) {
    it.enabled == <span class="pl-c1">true</span>
}

<span class="pl-c">// Matching a RadioGroup by id</span>
assertAny&lt;RadioGroup&gt;(R.id.radioGroup) {
    it.checkedRadioButtonId == R.id.option1
}

<span class="pl-c">// Matching a Progressbar by a Matcher</span>
assertAny&lt;Progressbar&gt;(withId(R.id.progressBar)) {
    it.progress == <span class="hljs-number">42</span>
}

<span class="pl-c">// You can also define the assertion description that will be shown if the assertion fails</span>
assertAny&lt;RadioGroup&gt;(R.id.radioGroup, <span class="pl-s">&quot;selected option is the second one&quot;</span>) {
    it.checkedRadioButtonId == R.id.option1
}
</code></pre>
<h2 id="barista&apos;s-intents-api">Barista&#x2019;s Intents API</h2>
<pre><code class="lang-java"><span class="pl-c">// Creates a Bitmap on a camera provided URI</span>
mockAndroidCamera();
</code></pre>
<h2 id="runtime-permissions">Runtime Permissions</h2>
<p>The new Marshmallow permissions system requires checking for permissions at runtime. As Espresso can&apos;t interact with the system dialog, Barista offers a way to allow permissions when needed.</p>
<pre><code class="lang-java">PermissionGranter.allowPermissionsIfNeeded(Manifest.permission.GET_ACCOUNTS);
</code></pre>
<h2 id="useful-test-rules">Useful test rules</h2>
<p>Barista includes a set of useful test rules to help you:</p>
<h3 id="reseting-app-data">Reseting app data</h3>
<p>As tests should be isolated, they need to set the environment before running. Espresso doesn&apos;t help achieving it but Barista offers a set of rules to clear the app&apos;s data before running each test.</p>
<pre><code class="lang-java"><span class="pl-c">// Clear all app&apos;s SharedPreferences</span>
<span class="hljs-meta">@Rule</span> <span class="pl-k">public</span> ClearPreferencesRule clearPreferencesRule = <span class="pl-k">new</span> ClearPreferencesRule();

<span class="pl-c">// Delete all tables from all the app&apos;s SQLite Databases</span>
<span class="hljs-meta">@Rule</span> <span class="pl-k">public</span> ClearDatabaseRule clearDatabaseRule = <span class="pl-k">new</span> ClearDatabaseRule();

<span class="pl-c">// Delete all files in getFilesDir() and getCacheDir()</span>
<span class="hljs-meta">@Rule</span> <span class="pl-k">public</span> ClearFilesRule clearFilesRule = <span class="pl-k">new</span> ClearFilesRule();
</code></pre>
<h3 id="dealing-with-flaky-tests">Dealing with Flaky tests</h3>
<p>We should try to write deterministic tests, but when everything else fails Barista helps you deal with flaky tests using a specific ActivityTestRule and a couple of annotations that repeat your tests multiple times.</p>
<pre><code class="lang-java"><span class="pl-c">// Use a RuleChain to wrap your ActivityTestRule with a FlakyTestRule</span>
<span class="pl-k">private</span> ActivityTestRule&lt;FlakyActivity&gt; activityRule = <span class="pl-k">new</span> ActivityTestRule&lt;&gt;(FlakyActivity.class);
<span class="pl-k">private</span> FlakyTestRule flakyRule = <span class="pl-k">new</span> FlakyTestRule();

<span class="hljs-meta">@Rule</span>
<span class="pl-k">public</span> RuleChain chain = RuleChain.outerRule(flakyRule)
    .around(activityRule);


<span class="pl-c">// Use @AllowFlaky to let flaky tests pass if they pass any time.</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-meta">@AllowFlaky</span>(attempts = <span class="hljs-number">5</span>)
<span class="hljs-function"><span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-ent">some_flaky_test</span><span class="hljs-params">()</span> <span class="pl-k">throws</span> Exception </span>{
  <span class="pl-c">// ...</span>
}

<span class="pl-c">// Use @Repeat to avoid flaky tests from passing if any repetition fails.</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-meta">@Repeat</span>(times = <span class="hljs-number">5</span>)
<span class="hljs-function"><span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-ent">some_important_test</span><span class="hljs-params">()</span> <span class="pl-k">throws</span> Exception </span>{
  <span class="pl-c">// ...</span>
}
</code></pre>
<h3 id="one-rule-to-rule-them-all">One rule to rule them all</h3>
<p>All previous rules can be added at the same time by just adding the BaristaRule.</p>
<pre><code class="lang-java"><span class="hljs-meta">@Rule</span>
<span class="pl-k">public</span> BaristaRule&lt;MyActivity&gt; baristaRule = BaristaRule.create(MyActivity.class);

<span class="pl-c">//...</span>

baristaRule.launchActivity();
</code></pre>
<p>The rule assumes some sane defaults:</p>
<ul>
<li>Retry flaky tests: 10 attempts</li>
<li>Launch activity automatically: false</li>
<li>Initial touch mode enabled: true</li>
<li>Clear preferences</li>
<li>Clear databases</li>
<li>Clear files</li>
</ul>
<h3 id="writing-tests-in-kotlin">Writing tests in Kotlin?</h3>
<p><a href="https://github.com/SchibstedSpain/Barista/issues/219">Check this link</a> to know how to use <code>@Rule</code> in Kotlin.</p>
<h1 id="magic-that-barista-does-for-you">Magic that Barista does for you</h1>
<p>In order to speed up testing, Barista keeps in mind some considerations.</p>
<ul>
<li><strong>Scrolls when needed</strong>: Interacting with Espresso in a <code>ScrollView</code> requires you to scroll to each view, which sometimes doesn&apos;t work the first time. Also trying to scroll outside a <code>ScrollView</code> produces an <code>Exception</code>, forcing you to change the test depending on the layout. To keep tests simpler, Barista scrolls automatically before interacting with any <code>View</code>, and only does it if needed.</li>
<li><strong>Scrolls on all views</strong>: Barista scrolls on all scrollable views, including <code>NestedScrollView</code>. Espresso only handles <code>ScrollView</code> and <code>HorizontalScrollView</code>, so people need to open questions on <a href="https://stackoverflow.com/questions/35272953/espresso-scrolling-not-working-when-nestedscrollview-or-recyclerview-is-in-coor">StackOverflow like this</a>. Or... just use <strong>Barista</strong>.</li>
<li><strong>Just interacts with displayed Views</strong>: Interacting with <code>View</code>s inside a <code>ViewPager</code> throws <code>AmbiguousViewMatcherException</code>, because the views you interact with will be potentially repeated on different pages. Barista only interacts with displayed widgets, so you can focus on the behavior instead of wasting time on details.</li>
</ul>

        </div>
      </div>
    </div>
  </body>
</html>